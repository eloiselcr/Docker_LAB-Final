# =============================================================================
# ‚öõÔ∏è Dockerfile Frontend Template - React/Vite
# Build multi-√©tapes pour optimiser la taille finale
# =============================================================================

# =============================================================================
# üèóÔ∏è √âTAPE 1: BUILD (Compilation React)
# =============================================================================

FROM node:18-alpine AS build

# M√©tadonn√©es
LABEL maintainer="votre-nom@esiea.fr"
LABEL description="Frontend React pour projet microservices ESIEA"

# R√©pertoire de travail
WORKDIR /app

# Copier les fichiers de d√©pendances (optimisation cache Docker)
COPY package*.json ./

# Installer les d√©pendances
RUN npm ci --only=production

# Copier le code source
COPY . .

# TODO: Configurer l'URL de l'API au build time
ARG VITE_API_URL=http://localhost:8000
ENV VITE_API_URL=$VITE_API_URL

# Build de production
RUN npm run build

# =============================================================================
# üåê √âTAPE 2: PRODUCTION (Serveur nginx)
# =============================================================================

FROM nginx:alpine

# Copier les fichiers build√©s depuis l'√©tape pr√©c√©dente
COPY --from=build /app/dist /usr/share/nginx/html

# TODO: Copier votre configuration nginx personnalis√©e si n√©cessaire
# COPY nginx.conf /etc/nginx/nginx.conf

# Port d'exposition
EXPOSE 80

# =============================================================================
# üè• HEALTH CHECK OBLIGATOIRE
# =============================================================================
# TODO: Cr√©er un endpoint /health dans votre app React ou nginx
HEALTHCHECK --interval=30s --timeout=10s --start-period=15s --retries=3 \
  CMD wget --quiet --tries=1 --spider http://localhost/ || exit 1

# D√©marrage automatique de nginx
CMD ["nginx", "-g", "daemon off;"]